{
  "MetaData": {
    "Schema": {
      "ManagerName": "ProcessSchemaManager",
      "UId": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
      "A2": "WatbProcess_bdf3a63",
      "A5": "7a77d891-77bf-4563-bb36-319b80ce9f18",
      "B1": [],
      "B2": [],
      "B3": [],
      "B6": "8108c094-174d-5046-f412-15f04639e24f",
      "B8": "8.1.2.3941",
      "FJ1": [],
      "IJ1": true,
      "BK8": "bb4d6607-026b-4b27-b640-8f5c77c1e89d",
      "IJ10": true,
      "BK15": [],
      "BK37": {
        "BL1": "Terrasoft.Core.Process.ProcessSchemaParameter",
        "UId": "cdd58be7-2dba-4a5e-869b-1ad5d6d7513a",
        "A2": "NotificationCaption",
        "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
        "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
        "L1": "8b3f29bb-ea14-4ce5-a5c5-293a929b6ba2",
        "L8": {
          "GS1": 3,
          "GS2": "[#[PropertyValue:Caption]#]"
        }
      },
      "BK1": "FFFFFFFF",
      "BK2": "FFBBBBBB",
      "BK3": [
        {
          "BL1": "Terrasoft.Core.Process.ProcessSchemaLaneSet",
          "UId": "43820f67-d171-42ef-ade1-e414146f5313",
          "A2": "LaneSet1",
          "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A5": "8108c094-174d-5046-f412-15f04639e24f",
          "BL7": "11a47caf-a0d5-41fa-a274-a0b11f77447a",
          "BL8": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "BM4": [
            {
              "BL1": "Terrasoft.Core.Process.ProcessSchemaLane",
              "UId": "162062fa-d230-451d-af24-ebc180a8d071",
              "A2": "Lane1",
              "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
              "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
              "A5": "8108c094-174d-5046-f412-15f04639e24f",
              "IL2": "43820f67-d171-42ef-ade1-e414146f5313",
              "BL7": "abcd74b9-5912-414b-82ac-f1aa4dcd554e",
              "BL8": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
              "CD1": [],
              "CD2": [],
              "CD4": "43820f67-d171-42ef-ade1-e414146f5313",
              "CD7": []
            }
          ]
        }
      ],
      "BK5": [],
      "BK4": [
        {
          "BL1": "Terrasoft.Core.Process.ProcessSchemaStartEvent",
          "UId": "a611747b-d65a-4927-a8f4-e2d4795f8f43",
          "A2": "StartEvent1",
          "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A5": "8108c094-174d-5046-f412-15f04639e24f",
          "IL2": "162062fa-d230-451d-af24-ebc180a8d071",
          "BL3": "50;184",
          "BL7": "53818048-7868-48f6-ada0-0ebaa65af628",
          "BL8": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "BN2": "31;31",
          "BO3": true,
          "FC1": []
        },
        {
          "BL1": "Terrasoft.Core.Process.ProcessSchemaTerminateEvent",
          "UId": "319bcb6c-8aab-40b6-9506-64efe31a7b88",
          "A2": "TerminateEvent1",
          "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A5": "8108c094-174d-5046-f412-15f04639e24f",
          "IL2": "162062fa-d230-451d-af24-ebc180a8d071",
          "BL3": "528;184",
          "BL7": "1bd93619-0574-454e-bb4e-cf53b9eb9470",
          "BL8": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "BN2": "31;31",
          "BO3": true,
          "FC1": []
        },
        {
          "BL1": "Terrasoft.Core.Process.ProcessSchemaScriptTask",
          "UId": "7adddd49-d7d9-4fc7-ac2a-4f8fd36a25c7",
          "A2": "ScriptTask1",
          "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A5": "8108c094-174d-5046-f412-15f04639e24f",
          "IL2": "162062fa-d230-451d-af24-ebc180a8d071",
          "BL3": "268;172",
          "BL7": "0e490dda-e140-4441-b600-6f5c64d024df",
          "BL8": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "BN2": "69;55",
          "BO3": true,
          "BP2": [],
          "CL2": "FFFFFFFF",
          "CH1": "var accountsToNotify = GetAccountsToNotify(UserConnection);\r\nAddNewReminders(accountsToNotify, UserConnection);\r\n\r\nreturn true;",
          "CH2": true
        },
        {
          "BL1": "Terrasoft.Core.Process.ProcessSchemaSequenceFlow",
          "UId": "a2ff2fba-8a24-48ee-a9e5-0c4073ed4678",
          "A2": "SequenceFlow1",
          "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A5": "8108c094-174d-5046-f412-15f04639e24f",
          "BL7": "0d8351f6-c2f4-4737-bdd9-6fbfe0837fec",
          "BL8": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "CI1": "a611747b-d65a-4927-a8f4-e2d4795f8f43",
          "CI2": "7adddd49-d7d9-4fc7-ac2a-4f8fd36a25c7",
          "CI3": "null",
          "CI5": "FF939598",
          "CI6": 1,
          "CI11": "81;200",
          "CI12": "268;200"
        },
        {
          "BL1": "Terrasoft.Core.Process.ProcessSchemaSequenceFlow",
          "UId": "69957de5-ad0b-4693-86cf-cc37444d7778",
          "A2": "SequenceFlow3",
          "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A5": "8108c094-174d-5046-f412-15f04639e24f",
          "BL7": "0d8351f6-c2f4-4737-bdd9-6fbfe0837fec",
          "BL8": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "CI1": "7adddd49-d7d9-4fc7-ac2a-4f8fd36a25c7",
          "CI2": "319bcb6c-8aab-40b6-9506-64efe31a7b88",
          "CI3": "null",
          "CI5": "FF939598",
          "CI6": 1,
          "CI11": "337;200",
          "CI12": "528;200"
        }
      ],
      "BK9": [],
      "BK18": "Business Process",
      "BK29": true,
      "BK30": true,
      "BK32": "public Guid activeStatusId = new Guid(\"1FBA3241-B34C-40C5-A630-70184F1EE06A\");\r\npublic Guid accountSchemaId = new Guid(\"6404D801-E280-418A-A77C-D02B98271499\");\r\n\r\npublic List<AccountDto> GetAccountsToNotify(UserConnection connection)\r\n{\r\n    var accountsToNotify = new List<AccountDto>();\r\n\r\n    var select  = new Select(connection)\r\n        .Column(\"Id\")\r\n        .Column(\"WatbActiveStatusSettingDate\")\r\n        .Column(\"OwnerId\")\r\n        .Column(\"WatbStatusId\")\r\n        .Column(\"Name\")\r\n        .From(\"Account\")\r\n        as Select;\r\n\r\n    using (var dbExecutor = connection.EnsureDBConnection())\r\n    using (var dr = select.ExecuteReader(dbExecutor))\r\n    {\r\n        while(dr.Read())\r\n        {\r\n        \tvar activeStatusSettingDate = dr.GetColumnValue<DateTime>(\"WatbActiveStatusSettingDate\");\r\n        \tvar status = dr.GetColumnValue<Guid>(\"WatbStatusId\");\r\n        \t\r\n\t\t\tif (status == activeStatusId && (DateTime.UtcNow - activeStatusSettingDate).TotalHours > 24)\r\n            {\r\n                var owner = dr.GetColumnValue<Guid>(\"OwnerId\");\r\n                var name = dr.GetColumnValue<string>(\"Name\");\r\n                var id = dr.GetColumnValue<Guid>(\"Id\");\r\n\t\t\t\t\r\n                accountsToNotify.Add(new AccountDto\r\n                {\r\n                    Id = id,\r\n                    ActiveStatusSettingDate = activeStatusSettingDate,\r\n                    OwnerId = owner,\r\n                    Name = name\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    return accountsToNotify;\r\n}\r\n\r\npublic void AddNewReminders(List<AccountDto> accountsToNotify, UserConnection connection) \r\n{\r\n\tforeach (var account in accountsToNotify) \r\n\t{\r\n\t\tvar description = $\"У контрагента {account.Name} не заповнені усі обов'язкові поля.\";\r\n\t\t\r\n\t\tvar insert = new Insert(connection)\r\n\t\t    .Into(\"Reminding\")\r\n\t\t    .Set(\"CreatedOn\", Column.Parameter(DateTime.UtcNow))\r\n\t\t    .Set(\"CreatedById\", Column.Parameter(connection.CurrentUser.ContactId))\r\n\t\t    .Set(\"ModifiedOn\", Column.Parameter(DateTime.UtcNow))\r\n\t\t    .Set(\"ModifiedById\", Column.Parameter(connection.CurrentUser.ContactId))\r\n\t\t    .Set(\"ContactId\", Column.Parameter(account.OwnerId))\r\n\t\t    .Set(\"RemindTime\", Column.Parameter(DateTime.UtcNow))\r\n\t\t    .Set(\"Description\", Column.Parameter(description))\r\n\t\t    .Set(\"SubjectId\", Column.Parameter(account.Id))\r\n\t\t    .Set(\"SysEntitySchemaId\", Column.Parameter(accountSchemaId))\r\n\t\t    .Set(\"SubjectCaption\", Column.Parameter(description));\r\n\t\t    \r\n\t\tinsert.Execute();\r\n\t}\r\n}\r\n\r\npublic struct AccountDto\r\n{\r\n\tpublic Guid Id;\r\n\tpublic DateTime ActiveStatusSettingDate;\r\n\tpublic Guid OwnerId;\r\n\tpublic string Name;\r\n}",
      "BK34": "null",
      "Labels": [
        {
          "BL1": "Terrasoft.Core.Process.ProcessSchemaLabel",
          "UId": "4ad7d2bf-f973-30dd-25bf-2b7cc1008486",
          "A2": "ScriptTask1_label1",
          "A3": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "A4": "4517045d-6ceb-45b1-a73c-44d92f17f04e",
          "ParentUId": "7adddd49-d7d9-4fc7-ac2a-4f8fd36a25c7",
          "X": -29
        }
      ],
      "BK24": []
    }
  }
}